(window.webpackJsonp=window.webpackJsonp||[]).push([[7,12],{q5cp:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return d}));var r=t("rez4");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i,a,c=[],s=!0,l=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;s=!1}else for(;!(s=(r=i.call(t)).done)&&(c.push(r.value),c.length!==n);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return a(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */c=function(){return n};var e,n={},t=Object.prototype,r=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,n,t,r){Object.defineProperty(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r})}try{u({},"")}catch(e){u=function(e,n,t){return e[n]=t}}function f(n,t,r,o){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype);return u(a,"_invoke",function(n,t,r){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var s=E(c,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===o)throw o=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=3;var l=d(n,t,r);if("normal"===l.type){if(o=r.done?4:2,l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=4,r.method="throw",r.arg=l.arg)}}}(n,r,new O(o||[])),!0),a}function d(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var p={};function h(){}function m(){}function v(){}var y={};u(y,a,(function(){return this}));var b=Object.getPrototypeOf,g=b&&b(b(S([])));g&&g!==t&&r.call(g,a)&&(y=g);var w=v.prototype=h.prototype=Object.create(y);function x(e){["next","throw","return"].forEach((function(n){u(e,n,(function(e){return this._invoke(n,e)}))}))}function _(e,n){function t(i,a,c,s){var l=d(e[i],e,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==o(f)&&r.call(f,"__await")?n.resolve(f.__await).then((function(e){t("next",e,c,s)}),(function(e){t("throw",e,c,s)})):n.resolve(f).then((function(e){u.value=e,c(u)}),(function(e){return t("throw",e,c,s)}))}s(l.arg)}var i;u(this,"_invoke",(function(e,r){function o(){return new n((function(n,o){t(e,r,n,o)}))}return i=i?i.then(o,o):o()}),!0)}function E(n,t){var r=t.method,o=n.i[r];if(o===e)return t.delegate=null,"throw"===r&&n.i.return&&(t.method="return",t.arg=e,E(n,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var i=d(o,n.i,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[n.r]=a.value,t.next=n.n,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function j(e){this.tryEntries.push(e)}function k(n){var t=n[4]||{};t.type="normal",t.arg=e,n[4]=t}function O(e){this.tryEntries=[[-1]],e.forEach(j,this),this.reset(!0)}function S(n){if(null!=n){var t=n[a];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var i=-1,c=function t(){for(;++i<n.length;)if(r.call(n,i))return t.value=n[i],t.done=!1,t;return t.value=e,t.done=!0,t};return c.next=c}}throw new TypeError(o(n)+" is not iterable")}return m.prototype=v,u(w,"constructor",v),u(v,"constructor",m),u(v,l,m.displayName="GeneratorFunction"),n.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===m||"GeneratorFunction"===(n.displayName||n.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},n.awrap=function(e){return{__await:e}},x(_.prototype),u(_.prototype,s,(function(){return this})),n.AsyncIterator=_,n.async=function(e,t,r,o,i){void 0===i&&(i=Promise);var a=new _(f(e,t,r,o),i);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(w),u(w,l,"Generator"),u(w,a,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var n=Object(e),t=[];for(var r in n)t.unshift(r);return function e(){for(;t.length;)if((r=t.pop())in n)return e.value=r,e.done=!1,e;return e.done=!0,e}},n.values=S,O.prototype={constructor:O,reset:function(n){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!n)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var t=this;function r(e){a.type="throw",a.arg=n,t.next=e}for(var o=t.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],c=this.prev,s=i[1],l=i[2];if(-1===i[0])return r("end"),!1;if(!s&&!l)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=c){if(c<s)return this.method="next",this.arg=e,r(s),!0;if(c<l)return r(l),!1}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var o=r;break}}o&&("break"===e||"continue"===e)&&o[0]<=n&&n<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=e,i.arg=n,o?(this.method="next",this.next=o[2],p):this.complete(i)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),p},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t[2]===e)return this.complete(t[4],t[3]),k(t),p}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t[0]===e){var r=t[4];if("throw"===r.type){var o=r.arg;k(t)}return o}}throw Error("illegal catch attempt")},delegateYield:function(n,t,r){return this.delegate={i:S(n),r:t,n:r},"next"===this.method&&(this.arg=e),p}},n}function s(e,n,t,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function l(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){s(i,r,o,a,c,"next",e)}function c(e){s(i,r,o,a,c,"throw",e)}a(void 0)}))}}function u(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var n=function(e,n){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==o(n)?n:n+""}var d=function(){return e=function e(){var n=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.tableBody=document.querySelector("#shipping-table tbody"),this.addRangeButton=document.querySelector("#add-range"),this.addRangeButton.addEventListener("click",l(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector("#new-range-form"),e.next=3,n.renderForm({},(function(e){e.preventDefault();var o=new Biblys.Notification("Ajout en cours…",{loader:!0,sticky:!0});n.send(r).then((function(e){o.remove(),t.innerHTML="",n.fees.push(e),n.render(),new Biblys.Notification("L'option <strong>".concat(e.mode,"</strong> a bien été ajoutée."),{type:"success"})}))}));case 3:r=e.sent,t.appendChild(r);case 5:case"end":return e.stop()}}),e)})))),this.getAll()},(n=[{key:"getAll",value:function(){var e=this;return this.setLoadingState(!0),fetch("/api/admin/shipping",{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then((function(n){if(n.error)throw n.error.message;e.setLoadingState(!1),e.fees=n,e.render()})).catch(window._alert)}},{key:"send",value:function(e){var n=e.id.value?"/api/admin/shipping/".concat(e.id.value):"/api/admin/shipping",t=e.id.value?"PUT":"POST";return fetch(n,{method:t,credentials:"same-origin",headers:{Accept:"application/json"},body:JSON.stringify(Object.fromEntries(new FormData(e)))}).then((function(e){return e.json()})).then((function(e){if(e.error)throw e.error;return e})).catch(window._alert)}},{key:"setLoadingState",value:function(e){this.tableBody.innerHTML=e?'<tr><td colspan="1">Chargement…</tr></td>':""}},{key:"render",value:function(){var e=this;this.tableBody.innerHTML="",this.fees.map((function(n){return e.renderRow(n)})).forEach((function(n){return e.tableBody.appendChild(n)}))}},{key:"renderRow",value:function(e){var n="",t="";e.is_compliant_with_french_law||(t='<span class="fa fa-exclamation-triangle" title="Ce tarif n\'est pas conforme à la loi française"></span>',n="table-warning");var o=Object(r.default)('\n      <tr class="'.concat(n,'">\n        <td>').concat(t," ").concat(e.mode,"</td>\n        <td>").concat(e.type,"</td>\n        <td>").concat(e.zone_name,'</td>\n        <td class="nowrap">').concat(this.renderConditions(e),'</td>\n        <td class="right">').concat(window.currency(parseInt(e.fee)/100),"</td>\n      </tr>\n    ")),i=Object(r.default)('<td class="action-buttons"></td>');return i.appendChild(this.renderEditIcon(e,o)),i.appendChild(this.renderArchiveIcon(e,o)),i.appendChild(this.renderDeleteIcon(e)),o.appendChild(i),o}},{key:"renderEditIcon",value:function(e,n){var t=this,o=Object(r.default)('<span class="btn btn-primary btn-sm">\n        <span class="fa fa-pencil pointer" aria-label="modifier l\'option\'"></span>\n      </span>');return o.addEventListener("click",(function(){return t.onRangeEditButtonClick(e,n)})),o}},{key:"onRangeEditButtonClick",value:function(e,n){window.confirm("Modifier une option existante peut impacter les commandes en cours. Il est recommandé de créer une nouvelle option et d'archiver l'ancienne plutôt que de modifier une option existante. Voulez-vous vraiment modifier l'option ".concat(e.mode,"?"))&&this.showRangeEditForm(e,n)}},{key:"renderArchiveIcon",value:function(e){var n=this,t=Object(r.default)('<span class="btn btn-warning btn-sm">\n        <span class="fa fa-archive pointer" aria-label="Archiver l\'option"></span>\n      </span>');return t.addEventListener("click",(function(){return n.archiveRange(e)})),t}},{key:"renderDeleteIcon",value:function(e){var n=this,t=Object(r.default)('<span class="btn btn-danger btn-sm">\n        <span class="fa fa-trash-can pointer" aria-label="Supprimer l\'option"></span>\n      </span>');return t.addEventListener("click",(function(){return n.deleteRange(e)})),t}},{key:"renderConditions",value:function(e){var n=i([e.max_weight,e.min_amount,e.max_amount,e.max_articles].map((function(e){return null===e?null:parseInt(e)})),4),t=n[0],r=n[1],o=n[2],a=n[3],c=[];return null!==t&&c.push("≤ ".concat(t," g")),null!==r&&c.push("≥ ".concat(window.currency(r/100))),null!==o&&c.push("≤ ".concat(window.currency(o/100))),null!==a&&c.push("≤ ".concat(a," articles")),c.join("<br/>")}},{key:"renderForm",value:(s=l(c().mark((function e(n,t){var r,o,i,a,s,l,u,f,d,p,h,m,v,y,b,g,w,x,_,E,j,k,O,S,A;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,o=void 0===r?"":r,i=n.mode,a=void 0===i?"":i,s=n.type,l=void 0===s?"":s,u=n.zone_id,f=void 0===u?"":u,d=n.max_weight,p=void 0===d?"":d,h=n.min_amount,m=void 0===h?"":h,v=n.max_amount,y=void 0===v?"":v,b=n.max_articles,g=void 0===b?"":b,w=n.fee,x=void 0===w?"":w,_=n.info,E=void 0===_?"":_,e.next=3,fetch("/api/admin/shipping/zones",{headers:{Accept:"application/json"}});case 3:return j=e.sent,e.next=6,j.json();case 6:return k=e.sent,O=k.map((function(e){return'<option value="'.concat(e.id,'" ').concat(f===e.id?"selected":"",">").concat(e.name,"</option>")})).join(""),S='\n      <input type="hidden" id="id" name="id" value="'.concat(o,'">\n\n      <div class="form-group">\n        <label class="col-form-label label-inline" for="mode">Intitulé :</label>\n        <input type="text" id="mode" name="mode" class="form-control" value="').concat(a,'" required>\n      </div>\n\n      <div class="form-group">\n        <label class="col-form-label label-inline" for="mode">Type d\'envoi :</label>\n        <select id="type" name="type" class="form-control" required>\n          <option value="normal" ').concat("normal"===l?"selected":"",'>Normal</option>\n          <option value="colissimo" ').concat("colissimo"===l?"selected":"",'>Colissimo</option>\n          <option value="mondial-relay" ').concat("mondial-relay"===l?"selected":"",'>Mondial Relay</option>\n          <option value="magasin" ').concat("magasin"===l?"selected":"",'>Retrait en magasin</option>\n        </select>\n      </div>\n\n      <div class="form-group">\n        <label class="col-form-label label-inline" for="zone_id">Zone :</label>\n        <select id="zone_id" name="zone_id" class="form-control" required>\n          ').concat(O,'\n        </select>\n      </div>\n\n      <fieldset>\n        <legend>Conditions</legend>\n\n        <p>\n          Cette option d\'expédition sera proposée au client si la commande :\n        </p>\n\n        <div class="form-group">\n          <label class="col-form-label label-inline" for="max_weight">… a un poids (en grammes) inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_weight" name="max_weight" class="form-control" value="').concat(p,'">\n        </div>\n\n        <div class="form-group">\n          <label class="col-form-label label-inline" for="min_amount">… a un montant (en centimes) supérieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="min_amount" name="min_amount" class="form-control" value="').concat(m,'">\n        </div>\n\n        <div class="form-group">\n          <label class="col-form-label label-inline" for="max_amount">… a un montant (en centimes) inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_amount" name="max_amount" class="form-control" value="').concat(y,'">\n        </div>\n\n        <div class="form-group">\n          <label class="col-form-label label-inline" for="max_articles">… a un nombre d\'exemplaires inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_articles" name="max_articles" class="form-control" value="').concat(g,'">\n        </div>\n\n      </fieldset>\n\n      <div class="form-group">\n        <label class="col-form-label label-inline" for="fee">Montant (en centimes) :</label>\n        <input type="number" min="0" step="1" id="fee" name="fee" class="form-control" value="').concat(x,'" required>\n      </div>\n\n      <div class="form-group">\n        <label class="col-form-label label-inline" for="info">Commentaire (affiché au client lorsqu\'il choisit ce mode) :</label>\n        <input type="text" id="info" name="info" class="form-control" value="').concat(null===E?"":E,'">\n      </div>\n\n      <div class="form-group text-center">\n        <button type="submit" class="btn btn-primary">').concat(""===o?"Ajouter":"Modifier","</button>\n      </div>\n    "),(A=document.createElement("form")).classList.add("fieldset"),A.innerHTML=S,A.addEventListener("submit",t.bind(this)),e.abrupt("return",A);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return s.apply(this,arguments)})},{key:"archiveRange",value:function(e){var n=this;if(window.confirm("Voulez-vous vraiment archiver l'option ".concat(e.mode,"?"))){var t=new Biblys.Notification("Archivage en cours…",{loader:!0,sticky:!0});fetch("/api/admin/shipping/".concat(e.id,"/archive"),{method:"POST",credentials:"same-origin",headers:{Accept:"application/json"}}).then((function(e){return n._handleEmptyResponse(t,e)})).then((function(){new Biblys.Notification("L'option <strong>".concat(e.mode,"</strong> a bien été archivée."),{type:"success"}),n.fees=n.fees.filter((function(n){return n.id!==e.id})),n.render()})).catch(window._alert)}}},{key:"deleteRange",value:function(e){var n=this;if(window.confirm("Voulez-vous vraiment supprimer l'option ".concat(e.mode,"?"))){var t=new Biblys.Notification("Suppression en cours…",{loader:!0,sticky:!0});fetch("/api/admin/shipping/".concat(e.id),{method:"DELETE",credentials:"same-origin",headers:{Accept:"application/json"}}).then((function(e){return n._handleEmptyResponse(t,e)})).then((function(){new Biblys.Notification("L'option <strong>".concat(e.mode,"</strong> a bien été supprimée."),{type:"success"}),n.fees=n.fees.filter((function(n){return n.id!==e.id})),n.render()})).catch(window._alert)}}},{key:"_handleEmptyResponse",value:(a=l(c().mark((function e(n,t){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.remove(),204!==t.status){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t.json();case 5:if(!(r=e.sent).error){e.next=8;break}throw r.error.message;case 8:throw new Error("Une erreur est survenue.");case 9:case"end":return e.stop()}}),e)}))),function(e,n){return a.apply(this,arguments)})},{key:"showRangeEditForm",value:(o=l(c().mark((function e(n,t){var o,i,a,s=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Object(r.default)("<tr></tr>"),i=Object(r.default)("<td colspan=8></td>"),e.next=4,this.renderForm(n,(function(e){e.preventDefault();var t=new Biblys.Notification("Mise à jour de <strong>".concat(n.mode,"</strong> en cours…"),{loader:!0,sticky:!0});s.send(a).then((function(e){t.remove(),o.remove();var n=s.fees.findIndex((function(n){return e.id===n.id}));s.fees[n]=e,s.render(),new Biblys.Notification("L'option <strong>".concat(e.mode,"</strong> a bien été mise à jour."),{type:"success"})}))}));case 4:a=e.sent,o.appendChild(i),i.appendChild(a),t.after(o);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return o.apply(this,arguments)})}])&&u(e.prototype,n),t&&u(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,t,o,a,s}()},rez4:function(e,n,t){"use strict";function r(e){var n=document.createElement("template");return e=e.trim(),n.innerHTML=e,n.content.firstChild}t.r(n),t.d(n,"default",(function(){return r}))}}]);