(window.webpackJsonp=window.webpackJsonp||[]).push([[3,8,15],{"0+Gh":function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return u}));var a=n("9xd5");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,d(a.key),a)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==o(e)?e:e+""}var s=function(t,e){if("short"===e){var n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return'<span title="'.concat(t.toLocaleString(),'">').concat(n,"/").concat(a,"</span>")}},c=function(t,e){return Math.floor((t-e)/864e5)},l=function(t){var e=t.split(/[- :]/);return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5]))},u=i((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=this;n.data=e,n.getRow=function(){var t='<button title="Marquer comme expédiée" data-action="shipped" class="btn btn-sm btn-success"><i class="fa-solid fa-box"></i></button>',e="";n.pick&&(t='<button title="Marquer comme à dispo. en magasin" data-action="shipped" class="btn btn-sm btn-success"><i class="fa fa-shopping-bag"></i></button>'),n.overdued&&(e=' <button title="Relancer" data-action="followup" class="btn btn-sm btn-warning"><i class="fa fa-warning"></i></button>');var o=document.createElement("tr");return o.id="order_"+n.data.id,o.className="text-center "+n.class,o.innerHTML='<td title="'.concat(n.tooltip,'" class="va-middle"><i class="fa-solid ').concat(n.icon,'"></i></td>\n          <td><a href="/order/').concat(n.data.url,'">').concat(n.data.id,"</a></td>\n          <td>").concat(s(n.created_at,"short"),'</td>\n          <td class="text-left customer">').concat(n.data.customer,'</td>\n          <td class="text-right">').concat(n.data.total,'</td>\n          <td><a href="/invoice/').concat(n.data.url,'" class="btn btn-sm btn-light" title="Imprimer la facture" ><i class="fa fa-print"></i></a></td>\n          <td>').concat(n.data.payment_mode?'<img src="/assets/icons/payment_'.concat(n.data.payment_mode,'.png" alt="').concat(n.data.payment_mode,'" title="').concat(n.data.payment_mode,'" width=20 />'):"","</td>\n          <td>").concat(n.payed?s(n.payed_at,"short"):'<div class="btn-group">\n        <div class="dropdown">\n          <button class="btn btn-sm btn-success dropdown-toggle" title="Marquée comme payée" type="button" data-toggle="dropdown" aria-expanded="false">\n            <span class="fa-regular fa-money-bill-1"></span>\n          </button>\n          <div class="dropdown-menu">\n            <a class="dropdown-item pointer" data-action="payed" data-mode="card">Carte bancaire</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="cheque">Chèque</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="cash">Espèces</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="paypal">Paypal</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="payplug">Payplug</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="transfer">Virement</a>\n            <a class="dropdown-item pointer" data-action="payed" data-mode="exchange">Échange</a>\n          </div>\n        </div>'+e+"</div>","</td>\n          <td>").concat(n.shipped?s(n.shipped_at,"short"):t,'</td>\n          <td><button title="Annuler la commande" data-action="cancel" class="btn btn-sm btn-danger"><i class="fa fa-trash-can"></i></button></td>'),o.addEventListener("click",(function(t){var e=t.target.closest("[data-action]");if(e){var o=e.getAttribute("data-action"),r=e.querySelector("i"),i=r?r.className:"",d=null,s=null,c=document.getElementById("order_status"),l=c?c.value:null;if("cancel"===o)if(!confirm("Voulez-vous vraiment annuler la commande n° "+n.data.id+" de "+n.data.customer+" ?"))return!1;if(r&&(r.className="fa fa-spinner fa-spin"),["colissimo","mondial-relay"].includes(n.data.shipping_mode)&&"shipped"===o&&null===(s=window.prompt("Numéro de suivi ?")))return new a.default("La commande n'a pas été marquée comme expédiée.",{type:"warning"}),void(r&&(r.className=i));"payed"===o&&(d=e.getAttribute("data-mode")),fetch("/admin/orders/"+n.data.id+"/"+o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({payment_mode:d,tracking_number:s})}).then((function(t){return t.json()})).then((function(t){if(r&&(r.className=i),t.error)window._alert(t.error);else{n.data=t.order,n.updateStatus();var e=n.getRow(),d=document.getElementById("order_"+n.data.id);d&&d.parentNode&&d.parentNode.replaceChild(e,d);var s=document.getElementById("buttons_"+n.data.id);s&&s.parentNode&&s.parentNode.removeChild(s),t.notice&&new a.default(t.notice,{type:"success"}),("1"===l&&"payed"===o||"2"===l&&"shipped"===o||"3"===l&&"shipped"===o||"cancel"===o)&&setTimeout((function(){var t=document.getElementById("order_"+n.data.id);t&&(t.style.display="none")}),1e3)}})).catch((function(t){r&&(r.className=i),t&&t.response&&t.response.json?t.response.json().then((function(t){window._alert(t.error.message)})):window._alert("Erreur réseau")}))}})),o},n.updateStatus=function(){if(n.payed=!0,n.shipped=!0,n.overdued=!1,n.canceled=!1,n.icon="",n.class="",n.created_at=l(n.data.created),n.shipped_at=null,n.payed_at=null,null!==n.data.cancel_date)return n.canceled=!0,n.canceled_at=l(n.data.cancel_date),n.icon="fa-trash-can",n.class="canceled",n.tooltip="Annulée",n.shipped=!1,void(n.payed=!1);null===n.data.shipping_date?(n.shipped=!1,n.icon="fa-box",n.class=" table-success",n.tooltip="À expédier","magasin"===n.data.shipping_mode&&(n.icon="fa-shopping-bag",n.tooltip="À mettre à dispo. en magasin",n.pick=!0)):n.shipped_at=l(n.data.shipping_date),null===n.data.payment_date?(n.payed=!1,n.icon="fa-money",n.class=" table-warning",n.tooltip="À payer"):n.payed_at=l(n.data.payment_date);var t=c(new Date,n.created_at);if(!n.payed&&t>4&&(n.overdued=!0,n.icon="fa-warning",n.class=" table-danger",n.tooltip="À relancer",n.data.followup_date)){n.followed_up_at=l(n.data.followup_date);var e=c(new Date,n.followed_up_at);n.overdued=!1,n.icon="fa-clock",n.class="",n.tooltip="Relancée il y a "+e+" jours"}},n.updateStatus()}))},"1LNP":function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return d}));var a=n("0+Gh");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,i(a.key),a)}}function i(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==o(e)?e:e+""}var d=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.loadOrders(),document.getElementById("showOrders").addEventListener("submit",(function(t){t.preventDefault();var n=t.submitter.dataset.action;if("show"===n&&e.loadOrders(),"export"===n){var a="".concat(window.location.protocol,"//").concat(window.location.host).concat(t.submitter.dataset.export_url);window.location.href=e._addParamsToUrl(a).toString()}})),document.getElementById("load-more-orders-button").addEventListener("click",(function(){return e.loadMoreOrders()}))},(e=[{key:"loadOrders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._addParamsToUrl(document.location);e.searchParams.append("offset",t.toString()),0===t&&(document.getElementById("orders").innerHTML=""),document.getElementById("ordersLoading").style.display="";var n=document.getElementById("load-more-orders-button");n.style.opacity="0",fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(t){return t.json()})).then((function(t){if(document.getElementById("ordersLoading").style.display="none",t.error&&window._alert(t.error.message),t.results>0){var e=null;t.orders.forEach((function(t){var n=new a.default(t);e=n.getRow(),document.getElementById("orders").appendChild(e)}));var o=document.querySelectorAll("#orders tr"),r=document.getElementById("orders-count"),i=o.length;i<t.total&&(n.style.opacity="1",r.textContent=(t.total-i).toString())}else document.getElementById("orders").innerHTML='<tr><td colspan="10" class="text-center alert-success">Aucune commande à afficher.</td></tr>'}))}},{key:"loadMoreOrders",value:function(){var t=document.querySelectorAll("#orders tr").length;this.loadOrders(t)}},{key:"_addParamsToUrl",value:function(t){var e={status:document.getElementById("order_status").value,payment:document.getElementById("order_payment_mode").value,shipping:document.getElementById("order_shipping_mode").value,query:document.getElementById("query").value},n=new URL(t);return n.search=new URLSearchParams(e).toString(),n}}])&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}()},"9xd5":function(t,e,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,r(a.key),a)}}function r(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==a(e)?e:e+""}n.r(e),n.d(e,"default",(function(){return i}));var i=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.text=e,n=n||{},this.params={type:n.type||"info",timeout:n.timeout||2500,sticky:n.sticky||!1,closeButton:n.closeButton||!1,loader:n.loader||!1,sound:n.sound||!1},this.init()},(e=[{key:"init",value:function(){var t=this.getNotificationsContainer(),e=this.renderNotification();t.appendChild(e),this.params.closeButton&&this.addCloseButton(),this.params.loader&&this.addLoader(),this.params.sound&&this.playSound(),this.params.sticky||window.setTimeout(function(){this.remove()}.bind(this),this.params.timeout)}},{key:"getNotificationsContainer",value:function(){var t=document.querySelector(".notifications");return t||(t=this.createNotificationsContainer()),t}},{key:"createNotificationsContainer",value:function(){var t=document.createElement("div");return t.classList.add("notifications"),document.body.appendChild(t),t}},{key:"renderNotification",value:function(){return this.element=document.createElement("div"),this.element.classList.add("notification"),this.element.classList.add("alert"),this.element.classList.add("alert-"+this.params.type),this.element.innerHTML=this.text,this.element}},{key:"addCloseButton",value:function(){var t=document.createElement("span");t.classList.add("fa"),t.classList.add("fa-close"),this.element.insertAdjacentElement("afterbegin",t),t.addEventListener("click",function(){this.remove()}.bind(this))}},{key:"addLoader",value:function(){var t=document.createElement("span");t.classList.add("fa"),t.classList.add("fa-spinner"),t.classList.add("fa-spin"),this.element.insertAdjacentElement("afterbegin",t)}},{key:"playSound",value:function(){var t=document.createElement("audio");t.style.display="none",t.autoplay=!0,t.innerHTML='<source src="/assets/sounds/'+this.params.sound+'.mp3" type="audio/mp3">',this.element.appendChild(t)}},{key:"remove",value:function(){this.element.style.opacity=0,window.setTimeout(function(){this.element.parentNode.removeChild(this.element)}.bind(this),400)}}])&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}()}}]);