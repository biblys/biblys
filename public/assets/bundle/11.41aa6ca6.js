(window.webpackJsonp=window.webpackJsonp||[]).push([[11,17],{q5cp:function(n,e,t){"use strict";t.r(e),t.d(e,"default",(function(){return l}));var o=t("rez4");function a(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var t=[],o=!0,a=!1,r=void 0;try{for(var i,l=n[Symbol.iterator]();!(o=(i=l.next()).done)&&(t.push(i.value),!e||t.length!==e);o=!0);}catch(n){a=!0,r=n}finally{try{o||null==l.return||l.return()}finally{if(a)throw r}}return t}(n,e)||function(n,e){if(!n)return;if("string"==typeof n)return r(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r(n,e)}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function i(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}var l=function(){function n(){var e=this;!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.tableBody=document.querySelector("#shipping-table tbody"),this.addRangeButton=document.querySelector("#add-range"),this.addRangeButton.addEventListener("click",(function(){var n=document.querySelector("#new-range-form"),t=e.renderForm({},(function(o){o.preventDefault();var a=new Biblys.Notification("Ajout en cours…",{loader:!0,sticky:!0});e.send(t).then((function(t){a.remove(),n.innerHTML="",e.fees.push(t),e.render(),new Biblys.Notification("La tranche <strong>".concat(t.mode,"</strong> a bien été ajoutée."),{type:"success"})}))}));n.appendChild(t)})),this.getAll()}var e,t,r;return e=n,(t=[{key:"getAll",value:function(){var n=this;return this.setLoadingState(!0),fetch("/api/shipping",{headers:{Accept:"application/json"}}).then((function(n){return n.json()})).then((function(e){n.setLoadingState(!1),n.fees=e,n.render()})).catch(window._alert)}},{key:"send",value:function(n){var e=n.id.value?"/api/shipping/".concat(n.id.value):"/api/shipping",t=n.id.value?"PUT":"POST";return fetch(e,{method:t,credentials:"same-origin",headers:{Accept:"application/json"},body:JSON.stringify(Object.fromEntries(new FormData(n)))}).then((function(n){return n.json()})).then((function(n){if(n.error)throw n.error;return n})).catch(window._alert)}},{key:"setLoadingState",value:function(n){this.tableBody.innerHTML=n?'<tr><td colspan="1">Chargement…</tr></td>':""}},{key:"render",value:function(){var n=this;this.tableBody.innerHTML="",this.fees.map((function(e){return n.renderRow(e)})).forEach((function(e){return n.tableBody.appendChild(e)}))}},{key:"renderRow",value:function(n){var e=Object(o.default)("\n      <tr>\n        <td>".concat(n.mode,"</td>\n        <td>").concat(n.type,"</td>\n        <td>").concat(n.zone,'</td>\n        <td class="nowrap">').concat(this.renderConditions(n),'</td>\n        <td class="right">').concat(window.currency(parseInt(n.fee)/100),"</td>\n      </tr>\n    ")),t=Object(o.default)("<td></td>");return t.appendChild(this.renderEditIcon(n,e)),t.appendChild(this.renderDeleteIcon(n)),e.appendChild(t),e}},{key:"renderEditIcon",value:function(n,e){var t=this,a=Object(o.default)('<span class="btn btn-primary btn-sm">\n        <span class="fa fa-pencil pointer" title="modifier la tranche"></span>\n      </span>');return a.addEventListener("click",(function(){return t.showRangeEditForm(n,e)})),a}},{key:"renderDeleteIcon",value:function(n){var e=this,t=Object(o.default)('<span class="btn btn-primary btn-sm">\n        <span class="fa fa-trash pointer" title="Supprimer la tranche"></span>\n      </span>');return t.addEventListener("click",(function(){return e.deleteRange(n)})),t}},{key:"renderConditions",value:function(n){var e=a([n.max_weight,n.min_amount,n.max_amount,n.max_articles].map((function(n){return null===n?null:parseInt(n)})),4),t=e[0],o=e[1],r=e[2],i=e[3],l=[];return null!==t&&l.push("≤ ".concat(t," g")),null!==o&&l.push("≥ ".concat(window.currency(o/100))),null!==r&&l.push("≤ ".concat(window.currency(r/100))),null!==i&&l.push("≤ ".concat(i," articles")),l.join("<br/>")}},{key:"renderForm",value:function(n,e){var t=n.id,o=void 0===t?"":t,a=n.mode,r=void 0===a?"":a,i=n.type,l=void 0===i?"":i,c=n.zone,s=void 0===c?"":c,u=n.max_weight,d=void 0===u?"":u,p=n.min_amount,m=void 0===p?"":p,f=n.max_amount,v=void 0===f?"":f,b=n.max_articles,h=void 0===b?"":b,y=n.fee,g=void 0===y?"":y,w=n.info,L=void 0===w?"":w,j='\n      <input type="hidden" id="id" name="id" value="'.concat(o,'">\n\n      <div class="form-group">\n        <label class="control-label label-inline" for="mode">Intitulé :</label>\n        <input type="text" id="mode" name="mode" class="form-control" value="').concat(r,'" required>\n      </div>\n\n      <div class="form-group">\n        <label class="control-label label-inline" for="mode">Type d\'envoi :</label>\n        <select id="type" name="type" class="form-control" required>\n          <option value="normal" ').concat("normal"===l?"selected":"",'>Normal</option>\n          <option value="suivi" ').concat("suivi"===l?"selected":"",'>Suivi avec numéro</option>\n          <option value="magasin" ').concat("magasin"===l?"selected":"",'>Retrait en magasin</option>\n        </select>\n      </div>\n\n      <div class="form-group">\n        <label class="control-label label-inline" for="zone">Zone :</label>\n        <select id="zone" name="zone" class="form-control" required>\n          <option value="ALL" ').concat("ALL"===s?"selected":"",'>ALL : Monde</option>\n          <option value="F" ').concat("F"===s?"selected":"",'>F : France</option>\n          <option value="OM1" ').concat("OM1"===s?"selected":"",'>\n            OM1 : Guadeloupe, Martinique, Guyane, La Réunion, Mayotte, Saint-Pierre-et-Miquelon, Saint-Martin, Saint-Barthélemy.\n          </option>\n          <option value="OM2" ').concat("OM2"===s?"selected":"",'>\n            OM2 : Nouvelle-Calédonie, Polynésie Française, Wallis-et-Futuna, Terres australes et antarctiques françaises.\n          </option>\n          <option value="A" ').concat("A"===s?"selected":"",'>\n            A : Union Européenne et Suisse\n          </option>\n          <option value="B" ').concat("B"===s?"selected":"",'>\n            B : Europe de l’Est (hors UE, Suisse et Russie), Norvège et Maghreb\n          </option>\n          <option value="C" ').concat("C"===s?"selected":"",'>\n            C : Autres destinations (hors UE et Suisse)\n          </option>\n        </select>\n      </div>\n\n      <fieldset>\n        <legend>Conditions</legend>\n\n        <p>\n          La tranche tarifaire sera proposé au client si la commande :\n        </p>\n\n        <div class="form-group">\n          <label class="control-label label-inline" for="max_weight">… a un poids (en grammes) inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_weight" name="max_weight" class="form-control" value="').concat(d,'">\n        </div>\n\n        <div class="form-group">\n          <label class="control-label label-inline" for="min_amount">… a un montant (en centimes) supérieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="min_amount" name="min_amount" class="form-control" value="').concat(m,'">\n        </div>\n\n        <div class="form-group">\n          <label class="control-label label-inline" for="max_amount">… a un montant (en centimes) inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_amount" name="max_amount" class="form-control" value="').concat(v,'">\n        </div>\n\n        <div class="form-group">\n          <label class="control-label label-inline" for="max_articles">… a un nombre d\'exemplaires inférieur ou égal à :</label>\n          <input type="number" min="1" step="1" id="max_articles" name="max_articles" class="form-control" value="').concat(h,'">\n        </div>\n\n      </fieldset>\n\n      <div class="form-group">\n        <label class="control-label label-inline" for="fee">Montant (en centimes) :</label>\n        <input type="number" min="0" step="1" id="fee" name="fee" class="form-control" value="').concat(g,'" required>\n      </div>\n\n      <div class="form-group">\n        <label class="control-label label-inline" for="info">Commentaire (affiché au client lorsqu\'il choisit ce mode) :</label>\n        <input type="text" id="info" name="info" class="form-control" value="').concat(null===L?"":L,'">\n      </div>\n\n      <div class="form-group text-center">\n        <button type="submit" class="btn btn-primary">').concat(""===o?"Ajouter":"Modifier","</button>\n      </div>\n    "),S=document.createElement("form");return S.classList.add("fieldset"),S.innerHTML=j,S.addEventListener("submit",e.bind(this)),S}},{key:"deleteRange",value:function(n){var e=this;if(window.confirm("Voulez-vous vraiment supprimer la tranche ".concat(n.mode,"?"))){var t=new Biblys.Notification("Suppression en cours…",{loader:!0,sticky:!0});fetch("/api/shipping/".concat(n.id),{method:"DELETE",credentials:"same-origin",headers:{Accept:"application/json"}}).then((function(){t.remove(),new Biblys.Notification("La tranche <strong>".concat(n.mode,"</strong> a bien été supprimée."),{type:"success"}),e.fees=e.fees.filter((function(e){return e.id!==n.id})),e.render()})).catch(window._alert)}}},{key:"showRangeEditForm",value:function(n,e){var t=this,a=Object(o.default)("<tr></tr>"),r=Object(o.default)("<td colspan=8></td>"),i=this.renderForm(n,(function(e){e.preventDefault();var o=new Biblys.Notification("Mise à jour de <strong>".concat(n.mode,"</strong> en cours…"),{loader:!0,sticky:!0});t.send(i).then((function(n){o.remove(),a.remove();var e=t.fees.findIndex((function(e){return n.id===e.id}));t.fees[e]=n,t.render(),new Biblys.Notification("La tranche <strong>".concat(n.mode,"</strong> a bien été mise à jour."),{type:"success"})}))}));a.appendChild(r),r.appendChild(i),e.after(a)}}])&&i(e.prototype,t),r&&i(e,r),n}()},rez4:function(n,e,t){"use strict";function o(n){var e=document.createElement("template");return n=n.trim(),e.innerHTML=n,e.content.firstChild}t.r(e),t.d(e,"default",(function(){return o}))}}]);